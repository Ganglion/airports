<html>
  <head>
    <title>Symbol Map</title>
    <link type="text/css" rel="stylesheet" href="css/ex.css"/>
    <link type="text/css" rel="stylesheet" href="css/jquery-ui-1.8.7.custom.css"/>
    <script type="text/javascript" src="js/protovis-r3.2.js"></script>
    <script type="text/javascript" src="js/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.7.custom.min.js"></script>    
    <script type="text/javascript" src="data/us_lowres.js"></script>
    <script type="text/javascript" src="data/degree_dist_geo.js"></script>
    <style type="text/css">

      #fig {
      width: 1210px;
      height: 650px;
      }

      #container {
      height: 10px;
      }

      #yearSlider {
      position: absolute;
      left: 100;
      right: 90;
      margin-top: 3;
      }

      #yearLabel {
      position: absolute;
      left: 0;
      width: 85;
      text-align: right;
      }

      #play {
      position: absolute;
      right: 50px;
      cursor: pointer;
      }

    </style>
  </head>
  <body><div id="center"><div id="fig">
        <div id="container">

          <b id="yearLabel">Year:</b
                                    ><div id="yearSlider"></div
                                                             ><img id="play" src="images/play.png" alt="Play" onclick="playClick()">
        </div>
        <script type="text/javascript+protovis">

          // Colors by ColorBrewer.org, Cynthia A. Brewer, Penn State.
          var colours = function(v) {
            if (v < 100) return "#8C510A";
            if (v < 1000) return "#D8B365";
            if (v < 10000) return "#F6E8C3";
            if (v < 100000) return "#F5F5F5";
            if (v < 1000000) return "#C7EAE5";
            if (v < 10000000) return "#5AB4AC";
            return "#01665E";
          };

          var color_bucket = ["#8C510A", "#D8B365", "#F6E8C3", "#F5F5F5", "#C7EAE5", "#5AB4AC", "#01665E"];

          //Just use slider to set the year we want
          var year,
              maxYear = 2009,
              minYear = 1990;
                    
          $(yearSlider).slider({
            min: minYear,
            max: maxYear,
            value: year = maxYear,
            slide: function(e, ui) {
              year = ui.value;
              degrees.root.render();
            }
          });

          var w       = 1215,
          h           = 600,
          yearsMargin = 100,
          rScale      = (1 / 80);

          var scale = pv.Geo.scale()
            .domain({lng: -128, lat: 24}, {lng: -64, lat: 50})
            .range({x: 0, y: 0}, {x: w, y: h});

          var yearsScale = pv.Scale.linear()
            .domain(minYear, maxYear)
            .range(yearsMargin + 2, w - yearsMargin);

          var timer = undefined;
          function playClick() {
            if (timer) {
              stop();
            } else {
              if (year == maxYear) year = minYear;
              $(yearSlider).slider('value', year);
              $(play).attr("src", 'images/stop.png');
              degrees.render();                    
              timer = setInterval(function() {
                year++;
                if (year >= maxYear) stop();
                $(yearSlider).slider('value', year);
                degrees.render();                    
              }, 900);
            }
          }

          // Stop the animation
          function stop() {
            clearInterval(timer);
            timer = undefined;
            $(play).attr("src", 'images/play.png');
          }

          // Add the main panel for the visualization
          var vis = new pv.Panel()
            .width(w)
            .height(h)
            .top(30);

          // Add the ticks and labels for the year slider
          vis.add(pv.Rule)
            .data(pv.range(minYear, maxYear + .1))
            .left(yearsScale)
            .height(4)
            .top(-20)
            .anchor("bottom").add(pv.Label);

          // Add a panel for each state
          var state = vis.add(pv.Panel)
            .data(us_lowres);

          // Add a panel for each state land mass
          state.add(pv.Panel)
            .data(function(c) c.borders)
            .add(pv.Line)
            .data(function(l) l)
            .left(scale.x)
            .top(scale.y)
            .fillStyle("#eee")
            .lineWidth(1)
            .strokeStyle("#ccc")
            .antialias(false);

          // Add the degrees

          var degrees = vis.add(pv.Panel)
            .data(function() degree_dist[year])
            .add(pv.Dot)
              .left(function(c) scale({lng:c.lng, lat:c.lat}).x)
              .top(function(c)  scale({lng:c.lng, lat:c.lat}).y)
              .fillStyle(function(c) colours(c.passenger_degree))
              .strokeStyle("black")
              .lineWidth(1)
              .radius(function(c) Math.sqrt(10*c.flights_degree)*rScale)

          // Add the legend
          vis.add(pv.Dot)
            .data(["up to 100", "up to 1,000", "up to 10,000", "up to 100,000", "up to 1,000,000", "up to 10,000,000", "greater than 10,000,000"])
            .left(10)
            .bottom(function() this.index * 12 + 10)
            .strokeStyle(null)
            .fillStyle(function() color_bucket[this.index])
            .anchor("right").add(pv.Label);

          vis.render();
          console.log("done :)");
        </script>
  </div></div></body>
</html>
